name: install-astronvim
type: shell
commands:
  # Install dependencies
  - apt-get update
  - apt-get install -y software-properties-common
  - add-apt-repository ppa:neovim-ppa/unstable -y
  - apt-get update
  - apt-get install -y neovim curl git unzip xclip ripgrep golang-go python3 python3-pip nodejs npm

   # Install lazygit
  - LAZYGIT_VERSION=$(curl -s "https://api.github.com/repos/jesseduffield/lazygit/releases/latest" | grep -Po '"tag_name": "v\K[^"]*')
  - curl -Lo lazygit.tar.gz "https://github.com/jesseduffield/lazygit/releases/latest/download/lazygit_${LAZYGIT_VERSION}_Linux_x86_64.tar.gz"
  - tar xf lazygit.tar.gz lazygit
  - install lazygit /usr/local/bin
  - rm lazygit lazygit.tar.gz

  # Install bottom
  - curl -sL https://raw.githubusercontent.com/ClementTsang/bottom/master/assets/download.sh | sh
  - mv ./bottom /usr/local/bin/


  # Install bottom
  - curl -sL https://raw.githubusercontent.com/ClementTsang/bottom/master/assets/download.sh | sh
  - mv ./bottom /usr/local/bin/

  # Install tree-sitter CLI
  - npm install -g tree-sitter-cli

  # Install Nerd Font 
  - mkdir -p /usr/local/share/fonts/
  - /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/JetBrains/JetBrainsMono/master/install_manual.sh)"
  - fc-cache -f -v

  # Backup existing Neovim config
  - mv ~/.config/nvim ~/.config/nvim.bak || true
  - mv ~/.local/share/nvim ~/.local/share/nvim.bak || true
  - mv ~/.local/state/nvim ~/.local/state/nvim.bak || true
  - mv ~/.cache/nvim ~/.cache/nvim.bak || true

  # Clone AstroNvim template
  - git clone --depth 1 https://github.com/AstroNvim/template ~/.config/nvim
  - rm -rf ~/.config/nvim/.git


  # Install AstroNvim plugins
  - nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'

  # Cleanup
  - apt-get clean
  - rm -rf /var/lib/apt/lists/*